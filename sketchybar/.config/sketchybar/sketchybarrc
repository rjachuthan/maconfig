#!/bin/bash

# Sketchybar Configuration
# https://felixkratz.github.io/SketchyBar

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Load colors from theme
source "$CONFIG_DIR/colors.sh"

##### Bar Appearance #####
sketchybar --bar position=top                \
                 height=40                   \
                 blur_radius=30              \
                 color=$BAR_COLOR            \
                 margin=10                   \
                 y_offset=6                  \
                 corner_radius=12            \
                 border_width=1              \
                 border_color=$BAR_BORDER_COLOR \
                 padding_left=12             \
                 padding_right=12            \
                 shadow=on                   \
                 sticky=on

##### Default Item Appearance #####
sketchybar --default icon.font="SF Pro:Semibold:14.0"   \
                     icon.color=$TEXT_COLOR             \
                     label.font="SF Pro:Semibold:13.0"  \
                     label.color=$TEXT_COLOR            \
                     background.color=$TRANSPARENT      \
                     background.corner_radius=8         \
                     background.height=28               \
                     padding_left=4                     \
                     padding_right=4                    \
                     label.padding_left=6               \
                     label.padding_right=6              \
                     icon.padding_left=8                \
                     icon.padding_right=4

##### Left Items #####

# Clock (left side like reference)
sketchybar --add item clock left                            \
           --set clock update_freq=10                       \
                       icon.drawing=off                     \
                       label.font="SF Pro:Bold:14.0"        \
                       label.color=$TEXT_BRIGHT             \
                       background.color=$ITEM_BG_COLOR      \
                       background.corner_radius=10          \
                       background.height=28                 \
                       background.padding_left=2            \
                       background.padding_right=2           \
                       label.padding_left=12                \
                       label.padding_right=12               \
                       script="$PLUGIN_DIR/clock.sh"

# Front App with icon
sketchybar --add item front_app left                                  \
           --set front_app icon.font="sketchybar-app-font:Regular:16.0" \
                           icon.color=$ACCENT_COLOR                   \
                           label.font="SF Pro:Semibold:13.0"          \
                           label.color=$TEXT_COLOR                    \
                           background.color=$ITEM_BG_COLOR            \
                           background.corner_radius=10                \
                           background.height=28                       \
                           icon.padding_left=10                       \
                           icon.padding_right=6                       \
                           label.padding_right=12                     \
                           script="$PLUGIN_DIR/front_app.sh"          \
           --subscribe front_app front_app_switched

##### Center Items - Workspaces #####

# Register aerospace workspace change event
sketchybar --add event aerospace_workspace_change

# Add workspace items
for sid in 1 2 3 4 5; do
    sketchybar --add item space.$sid center                         \
               --subscribe space.$sid aerospace_workspace_change    \
               --set space.$sid icon="$sid"                         \
                                icon.font="SF Pro:Bold:13.0"        \
                                icon.color=$TEXT_DIM                \
                                label.drawing=off                   \
                                background.color=$TRANSPARENT       \
                                background.corner_radius=10         \
                                background.height=28                \
                                icon.padding_left=12                \
                                icon.padding_right=12               \
                                click_script="aerospace workspace $sid" \
                                script="$PLUGIN_DIR/aerospace.sh $sid"
done

##### Right Items #####

# Battery
sketchybar --add item battery right                       \
           --set battery update_freq=120                  \
                         icon.font="SF Pro:Regular:16.0"  \
                         icon.color=$TEXT_COLOR           \
                         label.drawing=off                \
                         background.color=$ITEM_BG_COLOR  \
                         background.corner_radius=10      \
                         background.height=28             \
                         icon.padding_left=10             \
                         icon.padding_right=10            \
                         script="$PLUGIN_DIR/battery.sh"  \
           --subscribe battery system_woke power_source_change

# WiFi
sketchybar --add item wifi right                          \
           --set wifi icon=ó°–©                              \
                      icon.font="SF Pro:Regular:16.0"     \
                      icon.color=$TEXT_COLOR              \
                      label.drawing=off                   \
                      background.color=$ITEM_BG_COLOR     \
                      background.corner_radius=10         \
                      background.height=28                \
                      icon.padding_left=10                \
                      icon.padding_right=10               \
                      script="$PLUGIN_DIR/wifi.sh"        \
                      update_freq=30

# Volume
sketchybar --add item volume right                        \
           --set volume icon.font="SF Pro:Regular:16.0"   \
                        icon.color=$TEXT_COLOR            \
                        label.drawing=off                 \
                        background.color=$ITEM_BG_COLOR   \
                        background.corner_radius=10       \
                        background.height=28              \
                        icon.padding_left=10              \
                        icon.padding_right=10             \
                        script="$PLUGIN_DIR/volume.sh"    \
           --subscribe volume volume_change

##### Force Initial Update #####
sketchybar --update
